#
# Inter-Region tunnels
#

##### WEST DC1 to EAST DC3 ######################

config vpn ipsec phase1-interface
    edit "W{{dc_id}}E3_INET1"
        set type static
        set interface "Internet_1"
        set ike-version 2
        set peertype any
        set net-device disable
        {% if FOS < 7_000_000 %}
            set tunnel-search nexthop
        {% endif %}
        set add-route disable
        {% if cross_region_advpn %}
            set auto-discovery-sender enable
            set auto-discovery-receiver enable
            set auto-discovery-forwarder enable
        {% endif %}
        {% if not cross_region_advpn and FOS >= 7_000_000 %}
            set exchange-interface-ip enable
            set exchange-ip-addr4 10.200.{{dc_id}}.{{dc_id}}
        {% endif %}
        set dpd on-idle
        set dpd-retrycount 2
        set dpd-retryinterval 10
        set suite-b suite-b-gcm-128
        set psksecret W{{dc_id}}E3_INET1
        set remote-gw {{datacenter.east.first.inet1}}
        set comments "Tunnel between WEST DC{{dc_id}} and EAST DC3 over INET1"
    next
end

config vpn ipsec phase2-interface
    edit "W{{dc_id}}E3_INET1"
        set phase1name "W{{dc_id}}E3_INET1"
        set keepalive enable
    next
end

{% if cross_region_advpn or FOS < 7_000_000 %}
    config system interface
        edit "W{{dc_id}}E3_INET1"
            set ip 10.201.{{dc_id}}3.1 255.255.255.255
            set remote-ip 10.201.{{dc_id}}3.2 255.255.255.252
            set allowaccess ping
        next
    end
{% endif %}

config vpn ipsec phase1-interface
    edit "W{{dc_id}}E3_INET2"
        set type static
        set interface "Internet_2"
        set ike-version 2
        set peertype any
        set net-device disable
        {% if FOS < 7_000_000 %}
            set tunnel-search nexthop
        {% endif %}
        set add-route disable
        {% if cross_region_advpn %}
            set auto-discovery-sender enable
            set auto-discovery-receiver enable
            set auto-discovery-forwarder enable
        {% endif %}
        {% if not cross_region_advpn and FOS >= 7_000_000 %}
            set exchange-interface-ip enable
            set exchange-ip-addr4 10.200.{{dc_id}}.{{dc_id}}
        {% endif %}
        set dpd on-idle
        set dpd-retrycount 2
        set dpd-retryinterval 10
        set suite-b suite-b-gcm-128
        set psksecret W{{dc_id}}E3_INET2
        set remote-gw {{datacenter.east.first.inet2}}
        set comments "Tunnel between WEST DC{{dc_id}} and EAST DC3 over INET2"
    next
end

config vpn ipsec phase2-interface
    edit "W{{dc_id}}E3_INET2"
        set phase1name "W{{dc_id}}E3_INET2"
        set keepalive enable
    next
end

{% if cross_region_advpn or FOS < 7_000_000 %}
config system interface
    edit "W{{dc_id}}E3_INET2"
        set ip 10.202.{{dc_id}}3.1 255.255.255.255
        set remote-ip 10.202.{{dc_id}}3.2 255.255.255.252
        set allowaccess ping
    next
end
{% endif %}

config vpn ipsec phase1-interface
    edit "W{{dc_id}}E3_MPLS"
        set type static
        set interface "MPLS"
        set ike-version 2
        set peertype any
        set net-device disable
        {% if FOS < 7_000_000 %}
            set tunnel-search nexthop
        {% endif %}
        set add-route disable
        {% if cross_region_advpn %}
            set auto-discovery-sender enable
            set auto-discovery-receiver enable
            set auto-discovery-forwarder enable
        {% endif %}
        {% if not cross_region_advpn and FOS >= 7_000_000 %}
            set exchange-interface-ip enable
            set exchange-ip-addr4 10.200.{{dc_id}}.{{dc_id}}
        {% endif %}
        set dpd on-idle
        set dpd-retrycount 2
        set dpd-retryinterval 10
        set suite-b suite-b-gcm-128
        set psksecret W{{dc_id}}E3_MPLS
        set remote-gw {{datacenter.east.first.mpls}}
        set comments "Tunnel between WEST DC{{dc_id}} and EAST DC3 over MPLS"
    next
end

config vpn ipsec phase2-interface
    edit "W{{dc_id}}E3_MPLS"
        set phase1name "W{{dc_id}}E3_MPLS"
        set keepalive enable
    next
end

{% if cross_region_advpn or FOS < 7_000_000 %}
config system interface
    edit "W{{dc_id}}E3_MPLS"
        set ip 10.203.{{dc_id}}3.1 255.255.255.255
        set remote-ip 10.203.{{dc_id}}3.2 255.255.255.252
        set allowaccess ping
    next
end
{% endif %}

