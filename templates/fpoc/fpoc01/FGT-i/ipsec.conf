# ===== IPsec
#

config vpn ipsec phase1-interface
    edit "vpn1"
        set interface "Inet1"
        set peertype any
        set suite-b suite-b-gcm-128
        set remote-gw {{hub}}
        set psksecret fortinet
        set dpd on-idle
        set localid "BR{{i}}_vpn1"
    next
    edit "vpn2"
        set interface "Inet2"
        set peertype any
        set suite-b suite-b-gcm-128
        set remote-gw {{hub}}
        set psksecret fortinet
        set dpd on-idle
        set localid "BR{{i}}_vpn2"
    next
    edit "vpn3"
        set interface "Inet3"
        set peertype any
        set suite-b suite-b-gcm-128
        set remote-gw {{hub}}
        set psksecret fortinet
        set dpd on-idle
        set localid "BR{{i}}_vpn3"
    next
end

# IPsec interfaces

config system interface
    edit "vpn1"
        set ip {{overlay}}.1.1 255.255.255.255
        set remote-ip {{overlay}}.1.254 255.255.255.0
    next
    edit "vpn2"
        set ip {{overlay}}.2.1 255.255.255.255
        set remote-ip {{overlay}}.2.254 255.255.255.0
    next
    edit "vpn3"
        set ip {{overlay}}.3.1 255.255.255.255
        set remote-ip {{overlay}}.3.254 255.255.255.0
    next
end

# Traffic selectors used to announce local-LAN and local overlay-ip

config vpn ipsec phase2-interface
    edit "vpn1"
        set phase1name "vpn1"
        set auto-negotiate enable
        set src-addr-type name
        set dst-addr-type name
        set src-name "LAN"
        set dst-name "all"
    next
    edit "vpn1_overlay"
        set phase1name "vpn1"
        set auto-negotiate enable
        set src-subnet {{overlay}}.1.1 255.255.255.255
    next
    edit "vpn2"
        set phase1name "vpn2"
        set auto-negotiate enable
        set src-addr-type name
        set dst-addr-type name
        set src-name "LAN"
        set dst-name "all"
    next
    edit "vpn2_overlay"
        set phase1name "vpn2"
        set auto-negotiate enable
        set src-subnet {{overlay}}.2.1 255.255.255.255
    next
    edit "vpn3"
        set phase1name "vpn3"
        set auto-negotiate enable
        set src-addr-type name
        set dst-addr-type name
        set src-name "LAN"
        set dst-name "all"
    next
    edit "vpn3_overlay"
        set phase1name "vpn3"
        set auto-negotiate enable
        set src-subnet {{overlay}}.3.1 255.255.255.255
    next
end
