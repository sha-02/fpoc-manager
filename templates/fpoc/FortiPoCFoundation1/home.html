{% extends '_base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}Home page{% endblock title %}

{% block content %}

<script>
function collectFortiPoCElements(formID)
{
  // Assign all the global FortiPoC Elements to the form being submitted
  document.getElementById('fpocSelection').setAttribute('form', formID);
  document.getElementById('fpocIP').setAttribute('form', formID);
  document.getElementById('previewOnly').setAttribute('form', formID);
  document.getElementById('targetedFOSversion').setAttribute('form', formID);
}

function selectDeselectFgt(selectDeselectCheckbox)
{
  {% for fgt in fortigates %}
    var ele=document.getElementsByName('{{fgt}}');
    if ( selectDeselectCheckbox.checked ) { ele[0].checked=true; }
    else { ele[0].checked=false; }
  {% endfor %}
}
function selectDeselectLxc(selectDeselectCheckbox)
{
  {% for lxc in lxces %}
    var ele=document.getElementsByName('{{lxc}}');
    if ( selectDeselectCheckbox.checked ) { ele[0].checked=true; }
    else { ele[0].checked=false; }
  {% endfor %}
}
function selectDeselectVyos(selectDeselectCheckbox)
{
  {% for vyos in vyoses %}
    var ele=document.getElementsByName('{{vyos}}');
    if ( selectDeselectCheckbox.checked ) { ele[0].checked=true; }
    else { ele[0].checked=false; }
  {% endfor %}
}
</script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> <!-- for tooltips -->
<script>
// Enable the tooltips
$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
});
</script>

<!-- FortiPoC VMs, FortiOS versions-->

<div class="d-flex justify-content-between ">
  <div class="d-flex flex-row bd-highlight mb-3 align-items-center">
    <div class="p-2 bd-highlight">
      Name<select id="fpocSelection" name="fpocSelection">
        <option value="0.0.0.0" selected>internal</option>
        {% for fpoc_name, fpoc_ip in fortipoc_VMs.items %}
          <option value="{{fpoc_ip}}">{{fpoc_name}}</option>
        {% endfor %}
      </select>
    </div>
    <div class="p-2 bd-highlight">
      or IP<input type="text" id="fpocIP" name="fpocIP" maxlength="15" size="15">
    </div>
  </div>
  <div class="d-flex flex-row bd-highlight mb-3 align-items-center">
    <div class="p-2 bd-highlight">
      <input type="checkbox" id="previewOnly" name="previewOnly"> preview-only
    </div>
    <div class="p-2 bd-highlight">
      <select id="targetedFOSversion" name="targetedFOSversion">
        <option value="">Any</option>
        {% for build in firmware %}
          <option value="{{build}}">{{build}}</option>
        {% endfor %}
          <option value="0.0.0.0">Tests</option>
      </select> FOS version
    </div>
  </div>
</div>



<!--<div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">-->
<!--  <img src="{% static 'images/logo.png' %}" class="img-fluid" alt="DjangoX logo"/>-->
<!--  <p class="lead">A Django starter project with batteries.</p>-->
<!--</div>-->
<div class="accordion" id="accordionPoC">

  <!-- ========================================================================================================= -->
  <!-- FortiPoCFoundation1 -->
  <!-- ========================================================================================================= -->
  <div class="card">
  <div class="card-header" id="heading-0">
    <h2 class="mb-0">
      <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapse-1" aria-expanded="true" aria-controls="collapse-1">
        FortiPoCFoundation1
      </button>
    </h2>
  </div>
  <div id="collapse-1" class="collapse" aria-labelledby="heading-0" data-parent="#accordionPoC">
    <div class="card-body">
      <!-- 'Bootstrap' form -->
      <form id="formFortiPoCFoundation1" method="post" onsubmit="collectFortiPoCElements(this.id)">
        {% csrf_token %}
        <fieldset>
          <div class="container">
            <div class="row">
              <div class="col">
                <input type="checkbox" name="fgtCheckbox" onclick="selectDeselectFgt(this)" checked>
                <b>FortiGates</b>
                {% for fgt in fortigates %}
                  <br><input type="checkbox" name="{{fgt}}" checked> {{fgt}}
                {% endfor %}
                <hr>
                WAN underlays <input type="checkbox" name="WAN_underlays">
                <br>HA <select name="HA">
                    <option value="standalone" selected>standalone</option>
                    <option value="FGCP">FGCP</option>
                  </select>
                <br>central-management <input type="checkbox" name="FMG">
              </div>
              <div class="col">
                <input type="checkbox" name="lxcCheckbox" onclick="selectDeselectLxc(this)" checked>
                <b>LXC</b>
                {% for lxc in lxces %}
                  <br><input type="checkbox" name="{{lxc}}" checked> {{lxc}}
                {% endfor %}
              </div>
              <div class="col">
                <input type="checkbox" name="vyosCheckbox" onclick="selectDeselectVyos(this)" checked>
                <b>VyOS</b>
                {% for vyos in vyoses %}
                  <br><input type="checkbox" name="{{vyos}}" checked> {{vyos}}
                {% endfor %}
              </div>
            </div>
          </div>
        </fieldset>
        <br>
        <button type="submit" class="btn btn-warning btn-sm" title="Power on the selected devices" formaction="{% url 'fpoc:poweron' %}">Power-On Devices</button>
        <button type="submit" class="btn btn-warning btn-sm" title="Upgrade/Downgrade FortiGates" formaction="{% url 'fpoc:upgrade' %}">Upgrade FortiGates</button>
        <button type="submit" class="btn btn-info btn-sm" title="Deploy bootstrap configuration" formaction="{% url 'fpoc:bootstrap' %}" >Deploy Bootstrap Config to FortiGates</button>
      </form>
    </div>
  </div>
</div>

  <!-- ========================================================================================================= -->
  <!-- Multiple Path IPsec Dialup Hub and Spoke -->
  <!-- ========================================================================================================= -->
  <div class="card">
  <div class="card-header" id="heading-4">
    <h2 class="mb-0">
      <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapse-4" aria-expanded="false" aria-controls="collapse-4">
        IPsec Dialup Hub and Spoke -- Multiple Paths
      </button>
    </h2>
  </div>
  <div id="collapse-4" class="collapse" aria-labelledby="heading-2" data-parent="#accordionPoC">
    <div class="card-body">
      <h5>SDWAN+ADVPN - Dual DC & Dual Region</h5>
      <form id="formMultiPathIPsec1" method="post" onsubmit="collectFortiPoCElements(this.id)">
        {% csrf_token %}
          <fieldset>
            FGT
            <input type="checkbox" name="FGT-A" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-A)">West DC-1</span>
            <input type="checkbox" name="FGT-B" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-B)">West DC-2</span>
            <input type="checkbox" name="FGT-C" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-C)">West Branch-1</span>
            <input type="checkbox" name="FGT-D" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-D)">West Branch-2</span>
            <input type="checkbox" name="FGT-B_sec" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-B_sec)">East DC</span>
            <input type="checkbox" name="FGT-D_sec" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-D_sec)">East Branch</span>
            <input type="checkbox" name="FMG">
              <span data-toggle="tooltip" data-placement="top" title="(FMG)">FortiManager</span>
          </fieldset>
          <fieldset>
            LXC
            <input type="checkbox" name="PC_A1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_A1)">West DC-1</span>
            <input type="checkbox" name="PC_B1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_B1)">West DC-2</span>
            <input type="checkbox" name="PC_C1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_C1)">West Branch-1</span>
            <input type="checkbox" name="PC_D1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_D1)">West Branch-2</span>
            <input type="checkbox" name="PC_B2" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_B2)">East DC</span>
            <input type="checkbox" name="PC_D2" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_D2)">East Branch</span>
          </fieldset>
          <br>
          <fieldset>
            BGP design <select name="bgp_design">
              <option value='per_overlay' selected>BGP per overlay (7.0+)</option>
              <option value='on_loopback'>BGP on loopback (7.0.4+)</option>
              <option value='no_bgp'>No BGP (7.2+)</option>
              <option disabled>----------------------</option>
              <option value='per_overlay_legacy'>BGP per overlay legacy (6.4+)</option>
            </select>
            Overlay <select name="overlay">
              <option value='static'>static (exchange-interface-ip)</option>
              <option value='mode_cfg' selected>Dynamic (Mode-Config)</option>
            </select>
            <br>
            Hub-side Steering <select name="bidir_sdwan">
              <option value='none'>No Hub-side steering</option>
              <option value='route_tag' selected>SD-WAN with route-tags</option>
              <option value='route_priority'>BGP priority from route-map-preferable (7.2+)</option>
              <option value='remote_sla'>BGP priority from SD-WAN remote-sla (7.2.1+)</option>
          </select>
            BGP route priority to Branch <select name="bgp_priority">
            <option value='ecmp_links' selected>Multiple ECMP links</option>
            <option value='preferred_link'>Single preferred link</option>
          </select>
            <br>
            Remote Internet Access <select name="remote_internet">
              <option value='none'>DIA only</option>
              <option value='mpls' selected>RIA over MPLS</option>
              <option value='all'>RIA over all overlays</option>
            </select>
            <br>
            ADVPN shortcut routing <select name="shortcut_routing">
              <option value='exchange_ip' selected>BGP NH convergence with exchange-interface-ip</option>
              <option value='ipsec_selectors'>IPsec selectors (7.2+)</option>
              <option value='dynamic_bgp'>Dynamic BGP peering (7.???)</option>
            </select>
            <input type="checkbox" name="cross_region_advpn" value=1 checked> Cross-Regional shortcuts
            <br><input type="checkbox" name="vrf_aware_overlay" value=1> VRF segmentation over shared IPsec overlay (7.2+)
            <br><input type="checkbox" name="multicast" value=0> Multicast routing
          </fieldset>
        <br>
        <button type="submit" class="btn btn-info btn-sm" title="{% url 'fpoc:sdwan_advpn_dualdc_dualregion' %}" formaction="{% url 'fpoc:sdwan_advpn_dualdc_dualregion' %}" >Start</button>
      </form>
      <hr>
      <h5>SDWAN+ADVPN - Single Hub</h5>
      <form id="formMultiPathIPsec2" method="post" onsubmit="collectFortiPoCElements(this.id)">
        {% csrf_token %}
          <fieldset>
            FGT
            <input type="checkbox" name="FGT-A" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-A)">DataCenter</span>
            <input type="checkbox" name="FGT-B" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-B)">Branch-1</span>
            <input type="checkbox" name="FGT-C" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-C)">Branch-2</span>
            HA <select name="HA">
              <option value="standalone" selected>standalone</option>
              <option value="FGCP">FGCP</option>
            </select>
            <br>LXC
            <input type="checkbox" name="PC_A1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_A1)">DataCenter</span>
            <input type="checkbox" name="PC_B1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_B1)">Branch-1</span>
            <input type="checkbox" name="PC_C1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_C1)">Branch-2</span>
            <input type="hidden" name="FGT-A_sec" value="FGT-A_sec">
            <input type="hidden" name="FGT-B_sec" value="FGT-B_sec">
            <input type="hidden" name="FGT-C_sec" value="FGT-C_sec">
          </fieldset>
          <br>
          <div class="row">
            <div class="col">
              <b>FortiOS 7.0+</b>
              <fieldset>
                Remote Internet Access <select name="remote_internet">
                  <option value='none'>DIA only</option>
                  <option value='mpls' selected>RIA over MPLS</option>
                  <option value='all'>RIA over all overlays</option>
                </select>
                <br><input type="checkbox" name="vrf_aware_overlay" value=1> VRF-aware overlay (7.2+)
              </fieldset>
              <button type="submit" class="btn btn-info btn-sm" title="{% url 'fpoc:sdwan_advpn_singlehub_fos70' %}" formaction="{% url 'fpoc:sdwan_advpn_singlehub_fos70' %}">BGP per overlay</button>
            </div>
            <div class="col">
              <b>FortiOS 6.2+</b>
              <fieldset>
                Overlay <select name="overlay">
                  <option value='static'>static (exchange-interface-ip)</option>
                  <option value='modecfg' selected>Dynamic (Mode-Config)</option>
                </select>
              </fieldset>
              <fieldset>
                Duplicate Add-Paths <select name="duplicate_paths">
                  <option value='keep_duplicates' selected>Keep duplicates</option>
                  <option value='onnet_pref_spokes'>On-net preference on the Spokes</option>
                  <option value='offnet_filter_hub'>Off-net filtering on the Hub</option>
                </select>
                <br><input type="checkbox" name="override_with_hub_nexthop" value=1> Override off-net prefixes with the Hub's BGP Next-Hop
              </fieldset>
              <fieldset>
                Branches overlay static routes <select name="feasible_routes">
                  <option value='none' selected>No feasible route</option>
                  <option value='rfc1918'>RFC1918 routes</option>
                  <option value='remote_internet_all'>Default route (RBO/RIA) for all overlays</option>
                  <option value='remote_internet_mpls' selected>Default route (RBO/RIA) for MPLS</option>
                </select>
              </fieldset>
              <button type="submit" class="btn btn-warning btn-sm" title="{% url 'fpoc:sdwan_advpn_singlehub_fos62' %}" formaction="{% url 'fpoc:sdwan_advpn_singlehub_fos62' %}">Start</button>
            </div>
          </div>
      </form>
    </div>
  </div>
</div>

  <!-- ========================================================================================================= -->
  <!-- Single Path IPsec Dialup Hub and Spoke -->
  <!-- ========================================================================================================= -->
  <div class="card">
    <div class="card-header" id="heading-2">
      <h2 class="mb-0">
        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapse-2" aria-expanded="false" aria-controls="collapse-2">
          IPsec Dialup Hub and Spoke -- Single Path
        </button>
      </h2>
    </div>
    <div id="collapse-2" class="collapse" aria-labelledby="heading-2" data-parent="#accordionPoC">
      <div class="card-body">
        <form id="formSinglePathIPsec" method="post" action="{% url 'fpoc:vpn_dialup' %}" onsubmit="collectFortiPoCElements(this.id)">
          {% csrf_token %}
          <fieldset>
            FGT
            <input type="checkbox" name="FGT-A" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-A)">Hub</span>
            <input type="checkbox" name="FGT-B" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-B)">Spoke01</span>
            <input type="checkbox" name="FGT-C" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-C)">Spoke02</span>
            <input type="checkbox" name="FGT-D" checked>
              <span data-toggle="tooltip" data-placement="top" title="(FGT-D)">Spoke03</span>
          </fieldset>
          <fieldset>
            LXC
            <input type="checkbox" name="PC_A1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_A1)">Hub</span>
            <input type="checkbox" name="PC_B1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_B1)">Spoke01</span>
            <input type="checkbox" name="PC_C1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_C1)">Spoke02</span>
            <input type="checkbox" name="PC_D1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_D1)">Spoke03</span>
          </fieldset>
          <fieldset>
            Hub
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="Hub_NAT" value="None" checked> No NAT
              <input class="form-check-input" type="radio" name="Hub_NAT" value="DNAT"> DNAT
            </div>
            <br>
            Spoke01
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="Spoke01_NAT" value="None" checked> No NAT
              <input class="form-check-input" type="radio" name="Spoke01_NAT" value="SNAT"> SNAT
              <input class="form-check-input" type="radio" name="Spoke01_NAT" value="DNAT"> DNAT
            </div>
            <br>
            Spoke02
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="Spoke02_NAT" value="None" checked> No NAT
              <input class="form-check-input" type="radio" name="Spoke02_NAT" value="SNAT"> SNAT
              <input class="form-check-input" type="radio" name="Spoke02_NAT" value="DNAT"> DNAT
            </div>
            <br>
            Spoke03
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="Spoke03_NAT" value="None" checked> No NAT
              <input class="form-check-input" type="radio" name="Spoke03_NAT" value="SNAT"> SNAT
              <input class="form-check-input" type="radio" name="Spoke03_NAT" value="DNAT"> DNAT
            </div>
          </fieldset>
          <fieldset>
            IKE <select name="ike">
              <option value=1>v1</option>
              <option value=2 selected>v2</option>
            </select>
            Routing <select name="routing">
              <option value='ike-routing'>IKE routing (RRI)</option>
              <option value='modecfg-routing'>Mode-Config routing</option>
              <option value='ospf'>OSPF</option>
              <option value='ibgp' selected>iBGP Route Reflector</option>
              <option value='ibgp-confederation'>iBGP Confederation</option>
              <option value='ebgp'>eBGP</option>
            </select>
            Overlay <select name="overlay">
            <option value='unnumbered'>No overlay IP (unnumbered)</option>
            <option value='modecfg' selected>Dynamic (Mode-Config)</option>
            <option value='static'>static (exchange-interface-ip)</option>
            </select>
            <input type="checkbox" name="advpn" value=1 checked>ADVPN

          <button class="btn btn-info btn-sm" type="submit" data-toggle="tooltip" data-placement="bottom" title="{% url 'fpoc:vpn_dialup' %}">Start</button>
        </fieldset>
        </form>
      </div>
    </div>
  </div>

  <!-- ========================================================================================================= -->
  <!-- static VPN site to site -->
  <!-- ========================================================================================================= -->
  <div class="card">
    <div class="card-header" id="heading-3">
      <h2 class="mb-0">
        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapse-3" aria-expanded="false" aria-controls="collapse-3">
          VPN site-to-site (IPsec, GRE, GRE-IPsec, IPinIP, IPinIP-IPsec, Geneve)
        </button>
      </h2>
    </div>
    <div id="collapse-3" class="collapse" aria-labelledby="heading-3" data-parent="#accordionPoC">
      <div class="card-body">
        <h5>Two redundant static tunnels</h5>
        <form id="formStaticIPsec" method="post" action="{% url 'fpoc:vpn_site2site' %}" onsubmit="collectFortiPoCElements(this.id)">
          {% csrf_token %}
          <fieldset>
            Devices
            <input type="checkbox" name="FGT-A" checked>FGT-A
            <input type="checkbox" name="FGT-B" checked>FGT-B
            <br>
            LXC
            <input type="checkbox" name="PC_A1" checked>PC-A1
            <input type="checkbox" name="PC_A2" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_A2)">PC-A11</span>
            <input type="checkbox" name="PC_B1" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_B1)">PC-B2</span>
            <input type="checkbox" name="PC_B2" checked>
              <span data-toggle="tooltip" data-placement="top" title="(PC_B2)">PC-B22</span>
          </fieldset>
          <fieldset>
            VPN <select name="vpn">
              <option value='ipsec' selected>IPsec</option>
              <option value='gre'>GRE</option>
              <option value='gre-ipsec-transport'>GRE over transport IPsec</option>
              <option value='gre-ipsec-tunnel'>GRE over tunnel IPsec</option>
              <option value='gre-ipsec-phase1'>GRE over transport IPsec (ph1 encapsulation)</option>
              <option value='ipip'>IP-in-IP</option>
              <option value='ipip-ipsec-transport'>IP-in-IP over transport IPsec</option>
              <option value='ipip-ipsec-tunnel'>IP-in-IP over tunnel IPsec</option>
              <option value='geneve'>Geneve</option>
            </select>
            Routing <select name="routing">
              <option value='static' selected>static</option>
              <option value='ospf'>OSPF</option>
              <option value='ibgp'>iBGP (two peerings)</option>
              <option value='ibgp-loopback'>iBGP (peering over loopback via OSPF)</option>
              <option value='ebgp'>eBGP (two peerings)</option>
            </select>
            IKE <select name="ike">
              <option value=1>v1</option>
              <option value=2 selected>v2</option>
            </select>
            Phase1 <select name="ipsec_phase1">
              <option value='static2static' selected>Static to Static</option>
              <option value='static2dialup'>Static to Dialup</option>
            </select>
          <button class="btn btn-info btn-sm" type="submit" data-toggle="tooltip" data-placement="bottom" title="{% url 'fpoc:vpn_site2site' %}">Start</button>
        </fieldset>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock content %}


