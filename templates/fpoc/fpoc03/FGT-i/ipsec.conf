{# vpn == "ipsec" or vpn == "gre-ipsec-phase1"                  #}
{# vpn == "gre-ipsec-tunnel" or vpn == "gre-ipsec-transport"    #}
{# vpn == "ipip-ipsec-tunnel" or vpn == "ipip-ipsec-transport"  #}


# First IPsec tunnel

config vpn ipsec phase1-interface
    {% if vpn == "ipsec" or vpn == "gre-ipsec-phase1" %}
    edit "vpn1"
    {% else %}
    edit "ipsec1"
    {% endif %}

        set interface "INET1"
        set ike-version {{ike}}
        {% if vpn == "gre-ipsec-phase1" %}
            set encapsulation gre
        {% endif %}
        set peertype any
        set proposal aes128-sha1
        set dhgrp 14
        {% if i == 1 %}
            set remote-gw {{fgtb_inet1}}
        {% else %}
            set remote-gw {{fgta_inet1}}
        {% endif %}
        set psksecret 111111
    next
end

config vpn ipsec phase2-interface
    {% if vpn == "ipsec" or vpn == "gre-ipsec-phase1" %}
    edit "vpn1"
        set phase1name "vpn1"
    {% else %}
    edit "ipsec1"
        set phase1name "ipsec1"
    {% endif %}

        set proposal aes128-sha1
        set dhgrp 14
        set auto-negotiate enable
        {% if vpn == "gre-ipsec-phase1" or vpn == "gre-ipsec-transport" %}
            set encapsulation transport-mode
            set protocol 47
        {% endif %}
        {% if vpn == "ipip-ipsec-transport" %}
            set encapsulation transport-mode
            set protocol 4
        {% endif %}
    next
end

# Second IPsec tunnel

config vpn ipsec phase1-interface
    {% if vpn == "ipsec" or vpn == "gre-ipsec-phase1" %}
    edit "vpn2"
    {% else %}
    edit "ipsec2"
    {% endif %}

        set interface "INET2"
        set ike-version {{ike}}
        {% if vpn == "gre-ipsec-phase1" %}
            set encapsulation gre
        {% endif %}
        set peertype any
        set proposal aes128-sha1
        set dhgrp 14
        {% if i == 1 %}
            set remote-gw {{fgtb_inet2}}
        {% else %}
            set remote-gw {{fgta_inet2}}
        {% endif %}
        set psksecret 222222
    next
end

config vpn ipsec phase2-interface
    {% if vpn == "ipsec" or vpn == "gre-ipsec-phase1" %}
    edit "vpn2"
        set phase1name "vpn2"
    {% else %}
    edit "ipsec2"
        set phase1name "ipsec2"
    {% endif %}

        set proposal aes128-sha1
        set dhgrp 14
        set auto-negotiate enable
        {% if vpn == "gre-ipsec-phase1" or vpn == "gre-ipsec-transport" %}
            set encapsulation transport-mode
            set protocol 47
        {% endif %}
        {% if vpn == "ipip-ipsec-transport" %}
            set encapsulation transport-mode
            set protocol 4
        {% endif %}
    next
end
