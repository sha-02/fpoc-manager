{% if FMG_FORTIGATE_ID %}
    {% import 'SETTINGS.DEVICES' as SETTINGS with context %}

    {% set remote_internet = SETTINGS.DEVICES[FMG_FORTIGATE_ID].remote_internet %}
    {% set wan = SETTINGS.DEVICES[FMG_FORTIGATE_ID].wan %}
    {% set vrf_aware_overlay = SETTINGS.DEVICES[FMG_FORTIGATE_ID].vrf_aware_overlay %}
    {% set FOS = SETTINGS.DEVICES[FMG_FORTIGATE_ID].FOS %}
{% endif %}

###############################################################################################################
# Static routing

{# ================= Default routes =========================================================================== #}

# Static default-routes

# With BGP-on-loopback design, it is recommended to configure **default route** on the Spokes towards all the overlays
# 'remote_internet' is therefore ignored: default-route is always configured over all overlays

config router static
    edit 1
        unset gateway
        unset device
        set sdwan-zone "internet" "overlay"
        set comment "Default-route via Internet and all overlays"
    next
end

{% if vrf_aware_overlay and FOS >= 7_002_000 %}
# Default routes for SEGMENTS vith vrfid<>0

    config router static
    {% for name, segments in inter_segments.items() %}
        edit "{{10+loop.index0}}"
            set device "{{name}}1"
            set gateway {{segments[0].ip}}
            set comment "SEGMENT_{{segments[1].vrfid}} default-route"
        next
    {% endfor %}
    end
{% endif %}


{# ================= MPLS underlay  ============================================================================= #}
# MPLS underlay

config router static
    edit 3
        set dst {{wan.mpls_summary.network}}
        set device "MPLS"
        set gateway {{wan.mpls1.subnet}}.254
        set comment "MPLS underlay"
    next
end
