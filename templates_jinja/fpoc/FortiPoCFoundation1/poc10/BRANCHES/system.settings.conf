{% if FMG_FORTIGATE_ID %}
    {% import 'SETTINGS.DEVICES' as SETTINGS with context %}

    {% set branch_id = SETTINGS.DEVICES[FMG_FORTIGATE_ID].branch_id %}
    {% set region_id = SETTINGS.DEVICES[FMG_FORTIGATE_ID].region_id %}
{% endif %}

###############################################################################################################

# location-id is sent by branch to Hub during IKEv2 AUTH
# Use case: there are multiple IPsec tunnels from Branch terminated on the same dialup phase1-interface on Hub
# Hub's behavior:
# - all tunnels connecting to the same phase1-interface are grouped together if they have the same location-id.
# - In order to reply symmetrically, original incoming tunnel is cached in session.
# - For outgoing traffic, FOS does not necessarily use the tunnel returned by the routing lookup to send.
#   Instead, FOS tries to pick original incoming tunnel from the group to send.
#
# location-id is needed in this PoC since each branch connects mutiple times to the same dialup phase1 of the Hub
# due to the full-mesh of Internet IPsec tunnels between a Branch and its Hub
# Here, I'm using the BGP RID / loopback-IP as location-id

config system settings
    set location-id 10.200.{{region_id}}.{{branch_id}}
end
