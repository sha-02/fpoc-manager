{% if FMG_FORTIGATE_ID %}
    {% import 'SETTINGS.DEVICES' as SETTINGS with context %}

    {% set FOS = SETTINGS.DEVICES[FMG_FORTIGATE_ID].FOS %}
{% endif %}
#########################################################################################

# CONTEXT:
# - Cross-region shortcuts are NOT possible
#
# Solution:
# - FOS >= 7.0: eBGP for cross-region
# - Only local-region prefixes are needed on a Branch to build intra-region ADVPN shortcuts
# - Prefixes from other regions (edges and DCs) are aggregated under summary 10.0.0.0/14 which covers all LAN/DC subnets
#   summary 10.0.0.0/14 is advertised to edges via a BGP aggregate

config router access-list
    edit "LAN_REGIONAL_SUMMARY"
        config rule
            edit 1
                {% if region == 'West' %}
                    set prefix 10.0.0.0/14
                {% else %}
                    set prefix 10.4.0.0/14
                {% endif %}
                set exact-match enable
            next
        end
    next
end

config router route-map
    edit "REGION_OUT"
        config rule
            edit 1
                set match-ip-address "LAN_REGIONAL_SUMMARY"
                unset set-community
            next
            edit 100
                set action deny
            next
        end
    next
end
