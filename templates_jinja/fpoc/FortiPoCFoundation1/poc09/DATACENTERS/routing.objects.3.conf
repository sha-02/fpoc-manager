{% if FMG_FORTIGATE_ID %}
    {% import 'SETTINGS.DEVICES' as SETTINGS with context %}

    {% set FOS = SETTINGS.DEVICES[FMG_FORTIGATE_ID].FOS %}
{% endif %}

# CONTEXT:
# Bi-directional SD-WAN (Hub-side Steering) is required
# It is done by using route-tags
#

config router community-list
    edit "SLA_OK"
        config rule
            edit 1
                set action permit
                set match "65000:1"
            next
        end
    next
    edit "SLA_NOK"
        config rule
            edit 1
                set action permit
                set match "65000:2"
            next
        end
    next
end

config router route-map
    edit "routes_for_sdwan"
        config rule
            edit 1
                set match-community "SLA_OK"
                {% if bidir_sdwan == 'route_tag' %}
                    set set-route-tag 1
                {% endif %}
                {% if bidir_sdwan == 'route_priority' %}
                    set set-priority 1
                {% endif %}
            next
            edit 2
                set match-community "SLA_NOK"
                {% if bidir_sdwan == 'route_tag' %}
                    set set-route-tag 2
                {% endif %}
                {% if bidir_sdwan == 'route_priority' %}
                    set set-priority 2
                {% endif %}
            next
        end
    next
end
