{% if FMG_FORTIGATE_ID %}
    {% import 'SETTINGS.DEVICES' as SETTINGS with context %}

    {% set branch_id = SETTINGS.DEVICES[FMG_FORTIGATE_ID].branch_id %}
{% endif %}

###############################################################################################################
# FW addresses and groups

config firewall address
    edit "LAN"  {# Needed for PoC with ADVPN based on phase2 selectors #}
        set subnet 10.0.{{branch_id}}.0 255.255.255.0
    next
    edit "W-DC1"
        set subnet 10.1.0.0 255.255.255.0
    next
    edit "W-DC2"
        set subnet 10.2.0.0 255.255.255.0
    next
    edit "E-DC3"
        set subnet 10.3.0.0 255.255.255.0
    next
    edit "Branches"
        set subnet 10.0.0.0 255.255.0.0
        set allow-routing enable
    next
    edit "Overlays"
        set subnet 10.200.0.0 255.252.0.0
        set allow-routing enable
    next
    edit "Overlay_INET1"
        set subnet 10.201.0.0 255.255.0.0
        set allow-routing enable
    next
    edit "Overlay_INET2"
        set subnet 10.202.0.0 255.255.0.0
        set allow-routing enable
    next
    edit "Overlay_MPLS"
        set subnet 10.203.0.0 255.255.0.0
        set allow-routing enable
    next
end

config firewall addrgrp
    edit "DataCenters"
        set member "W-DC1" "W-DC2" "E-DC3"
    next
    edit "Corporate"
        set member "Branches" "DataCenters" "Overlays"
    next
end

# In-House Applications running on DC servers

config firewall address
    edit "DC1_server"
        set subnet 10.1.0.7 255.255.255.255
    next
    edit "DC2_server"
        set subnet 10.2.0.7 255.255.255.255
    next
    edit "DC3_server"
        set subnet 10.3.0.7 255.255.255.255
    next
end

config firewall addrgrp
    edit "DC_Servers"
        set member "DC1_server" "DC2_server" "DC3_server"
    next
end

config firewall internet-service-custom
    edit "DC.Services"
        set reputation 5
        set comment ''
        config entry
            edit 1
                set protocol 6
                config port-range
                    edit 1
                        set start-port 80
                        set end-port 80
                    next
                    edit 2
                        set start-port 8080
                        set end-port 8083
                    next
                end
                set dst "DC_Servers"
            next
            edit 2
                set protocol 17
                config port-range
                    edit 1
                        set start-port 8080
                        set end-port 8080
                    next
                end
                set dst "DC_Servers"
            next
            edit 3
                set protocol 1
                set dst "DC_Servers"
            next
        end
    next
end
