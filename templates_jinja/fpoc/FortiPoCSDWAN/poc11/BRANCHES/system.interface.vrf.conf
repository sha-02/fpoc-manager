{% if vrf_aware_overlay %}
# Interface updates for VRF

config system interface
    edit "{{wan.inet1.name}}"
        set vrf {{vrf_wan}}
    next
    edit "{{wan.inet2.name}}"
        set vrf {{vrf_wan}}
    next
    edit "{{wan.mpls1.name}}"
        set vrf {{vrf_wan}}
    next
    edit "{{lan.port}}"
        set vrf {{lan.vrfid}}
        set alias {{lan.alias}}
    next
    edit "lo-BGP"
        set vrf {{vrf_pe}}
    next
end

config system interface
    # LAN interfaces for the CE VRFs
    {% for name, segment in vrf_segments.items() %}
        {% if name != "LAN" %}  {# LAN(SEG0/port5/lan.port) is already defined above with regular interfaces #}
        edit "{{segment.alias}}"
            set vdom "root"
            set vrf {{segment.vrfid}}
            set ip {{segment.ip}} {{segment.mask}}
            set allowaccess ping
            set role lan
            set interface "{{lan.port}}"
            set vlanid {{segment.vlanid}}
        next
        {% endif %}
    {% endfor %}

    # Inter-VRF interfaces over vdom-link for DIA
    {% for name, isegs in inter_segments.items() -%}
        {% for segment in isegs %}
            edit "{{name}}{{loop.index0}}"
                set vdom "root"
                set vrf {{segment.vrfid}}
                set ip {{segment.ip}} {{segment.mask}}
                set allowaccess ping
            next
        {% endfor %}
    {% endfor -%}
end

#config system interface
#    edit "Internet_1_SNAT"
#        {{ "set vrf "~vrf_wan if vrf_aware_overlay }}
#    next
#    edit "Internet_2_SNAT"
#        {{ "set vrf "~vrf_wan if vrf_aware_overlay }}
#    next
#end

{% endif %} {# vrf_aware_overlay #}
