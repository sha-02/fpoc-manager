# fpoc04 Spoke1 FortiOS 7.0.3
# context = {'i': 3, 'mode': 'active_passive', 'hub1': '198.51.100.1', 'hub2': '198.51.100.2', 'name': 'Spoke1', 'fos_version': '7.0.3', 'FOS': 7000003, 'mgmt_fpoc': '172.16.31.254', 'HA': FortiGate_HA(mode=<Modes.STANDALONE: 0>, role=<Roles.STANDALONE: 0>, group_id=None, group_name=None, hbdev=None, sessyncdev=None, monitordev=None, priority=None), 'wan': WAN(inet=WanSettings(port='port1', vlanid=0, subnet='203.0.113'), inet_snat=WanSettings(port='port1', vlanid=200, subnet='192.168.200'), inet_dnat=WanSettings(port='port1', vlanid=201, subnet='192.168.201'), inet1=WanSettings(port='port1', vlanid=21, subnet='100.64.21'), inet1_snat=WanSettings(port='port1', vlanid=210, subnet='192.168.210'), inet1_dnat=WanSettings(port='port1', vlanid=211, subnet='192.168.211'), inet2=WanSettings(port='port1', vlanid=22, subnet='100.64.22'), inet2_snat=WanSettings(port='port1', vlanid=220, subnet='192.168.220'), inet2_dnat=WanSettings(port='port1', vlanid=221, subnet='192.168.221'), inet3=WanSettings(port='port1', vlanid=23, subnet='100.64.23'), inet3_snat=WanSettings(port='port1', vlanid=230, subnet='192.168.230'), inet3_dnat=WanSettings(port='port1', vlanid=231, subnet='192.168.231'), mpls1=WanSettings(port='port2', vlanid=24, subnet='10.0.24'), mpls2=WanSettings(port='port2', vlanid=25, subnet='10.0.25')), 'request': <WSGIRequest: POST '/poc/4/'>, 'csrf_input': '<input type="hidden" name="csrfmiddlewaretoken" value="IgwtZxM8odfA9Vk8azoMlEpbrZWG78apxGOie0P3loR0f5P0olKXbx4L7dIA0dCZ">', 'csrf_token': 'rvjA71qboGdjvGY8LmRa3QiV2ObVLQhWgVBpmut6lRPJBQt0Z8dlTJXvI2XPEVJw'}
#
##################################################



config system global
    set hostname Spoke1
    
        set gui-theme jade
    
end

# Interfaces

config system interface
    edit "port1"
        set vdom "root"
        set mode static
        set ip 203.0.113.3 255.255.255.0
        set allowaccess ping
        set alias "Internet"
    next
    edit "port5"
        set vdom "root"
        set mode static
        set ip 192.168.3.1 255.255.255.0
        set allowaccess ping
        set alias "LAN"
    next
    edit "port10"
        set allowaccess ping https ssh http telnet
        set alias "OOB Management"
    next
end

# addresses and groups

# IPsec

config vpn ipsec phase1-interface
    edit "advpn"
        set interface "port1"
        set peertype any
        set proposal aes128-sha1
        set add-route disable
        set dpd on-idle
        set auto-discovery-receiver enable
        set remote-gw 198.51.100.1
        set psksecret fortinet
        set dpd-retryinterval 2
    next
    edit "advpn2"
        set interface "port1"
        set peertype any
        set proposal aes128-sha1
        set add-route disable
        set dpd on-idle
        set auto-discovery-receiver enable
        set remote-gw 198.51.100.2
        set psksecret fortinet
        set dpd-retryinterval 2
    next
end

config vpn ipsec phase2-interface
    edit "advpn"
        set phase1name "advpn"
        set proposal aes128-sha1
    next
    edit "advpn2"
        set phase1name "advpn2"
        set proposal aes128-sha1
    next
end

config system interface
    edit "advpn"
        set ip 10.10.10.3 255.255.255.255
        set remote-ip 10.10.10.1 255.255.255.0
        set allowaccess ping
    next
    edit "advpn2"
        set ip 10.10.11.3 255.255.255.255
        set remote-ip 10.10.11.1 255.255.255.0
        set allowaccess ping
    next
end

# FW policy

config firewall policy
    edit 1
        set srcintf "any"
        set dstintf "any"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
    next
end

# Routing

config router static
    edit 1
        set gateway 203.0.113.254
        set device "port1"
    next
    edit 2
        set dst 10.10.10.0 255.255.255.0
        set device "advpn"
    next
    edit 3
        set dst 10.10.11.0 255.255.255.0
        set device "advpn2"
    next
    edit 222
        set dst 10.10.10.0 255.255.255.0
        set distance 254
        set blackhole enable
    next
    edit 333
        set dst 10.10.11.0 255.255.255.0
        set distance 254
        set blackhole enable
    next
end

config router route-map
    edit "RM_ADVPN1"
        config rule
            edit 1
                set set-local-preference 200
            next
        end
    next
end

config router bgp
    set as 65000
    set router-id 192.168.3.1
    config neighbor
        edit "10.10.10.1"
            set remote-as 65000
            set route-map-out "RM_ADVPN1"
            set keep-alive-timer 2
            set holdtime-timer 6
        next
        edit "10.10.11.1"
            set remote-as 65000
            set keep-alive-timer 2
            set holdtime-timer 6
        next
    end
    config network
        edit 1
            set prefix 192.168.3.0 255.255.255.0
        next
    end
end