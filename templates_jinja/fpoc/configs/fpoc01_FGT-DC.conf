# fpoc01 FGT-DC FortiOS 7.0.3
# context = {'name': 'FGT-DC', 'fos_version': '7.0.3', 'FOS': 7000003, 'mgmt_fpoc': '172.16.31.254', 'HA': FortiGate_HA(mode=<Modes.STANDALONE: 0>, role=<Roles.STANDALONE: 0>, group_id=None, group_name=None, hbdev=None, sessyncdev=None, monitordev=None, priority=None), 'wan': WAN(inet=WanSettings(port='port1', vlanid=0, subnet='192.0.2'), inet_snat=WanSettings(port='port1', vlanid=200, subnet='192.168.200'), inet_dnat=WanSettings(port='port1', vlanid=201, subnet='192.168.201'), inet1=WanSettings(port='port1', vlanid=31, subnet='100.64.31'), inet1_snat=WanSettings(port='port1', vlanid=210, subnet='192.168.210'), inet1_dnat=WanSettings(port='port1', vlanid=211, subnet='192.168.211'), inet2=WanSettings(port='port1', vlanid=32, subnet='100.64.32'), inet2_snat=WanSettings(port='port1', vlanid=220, subnet='192.168.220'), inet2_dnat=WanSettings(port='port1', vlanid=221, subnet='192.168.221'), inet3=WanSettings(port='port1', vlanid=33, subnet='100.64.33'), inet3_snat=WanSettings(port='port1', vlanid=230, subnet='192.168.230'), inet3_dnat=WanSettings(port='port1', vlanid=231, subnet='192.168.231'), mpls1=WanSettings(port='port2', vlanid=34, subnet='10.0.34'), mpls2=WanSettings(port='port2', vlanid=35, subnet='10.0.35')), 'request': <WSGIRequest: POST '/poc/1/'>, 'csrf_input': '<input type="hidden" name="csrfmiddlewaretoken" value="FfoHJmkumfpJJS2mqlH8kCKpEb4ZPsGXuFGwYPnpjq19P2xeE73javpZkpQTIx8x">', 'csrf_token': 'jAC9grkXRfDxLclUToCERBGH0KXvbE1580UYvUnSOqfXRmQM7aYPHulhGYJp4JtF'}
#
##################################################



config system global
    set hostname FGT-DC
    set gui-theme mariner
end

config system interface
    edit "Inet"
        set vdom "root"
        set interface "port1"
        set vlanid 31
        set mode static
        set ip 100.64.31.1 255.255.255.0
        set allowaccess ping
        set alias "Internet"
        set role wan
    next
    edit "port5"
        set vdom "root"
        set mode static
        set ip 192.168.255.254 255.255.255.0
        set allowaccess ping
        set alias "DC"
        set role lan
    next
    edit "port10"
        set vdom "root"
        set allowaccess ping https ssh http telnet
        set alias "OOB MGMT"
        set role lan
    next
    edit "loopback_VPNs"
        set vdom "root"
        set ip 10.255.1.254 255.255.255.255
        set allowaccess ping
        set type loopback
        set description "VPNs overlay subnets"
        set role lan
        set secondary-IP enable
        config secondaryip
            edit 1
                set ip 10.255.2.254 255.255.255.255
                set allowaccess ping
            next
            edit 2
                set ip 10.255.3.254 255.255.255.255
                set allowaccess ping
            next
            edit 3
                set ip 10.254.1.254 255.255.255.255
                set allowaccess ping
            next
            edit 4
                set ip 10.254.2.254 255.255.255.255
                set allowaccess ping
            next
            edit 5
                set ip 10.254.3.254 255.255.255.255
                set allowaccess ping
            next
        end
    next
end

config vpn ipsec phase1-interface
    edit "branches"
        set type dynamic
        set net-device enable
        set interface "Inet"
        set peertype any
        set dpd on-idle
        set suite-b suite-b-gcm-128
        set psksecret fortinet
        set dpd-retryinterval 60
    next
end

config vpn ipsec phase2-interface
    edit "branches"
        set phase1name "branches"
        set route-overlap allow
    next
end

config firewall address
    edit "DataCenter"
        set subnet 192.168.255.0 255.255.255.0
    next
    edit "Corporate-LANs"
        set subnet 192.168.0.0 255.255.0.0
    next
    edit "Overlay-255"
        set subnet 10.255.0.0 255.255.0.0
    next
    edit "Overlay-254"
        set subnet 10.254.0.0 255.255.0.0
    next
end

config firewall addrgrp
    edit "Overlays"
        set member "Overlay-255" "Overlay-254"
    next
    edit "Corporate"
        set member "Corporate-LANs" "Overlays"
    next
end

config firewall policy
    edit 1
        set name "Deny Internet"
        set srcintf "port5"
        set dstintf "Inet"
        set srcaddr "RFC1918-private-subnets"
        set dstaddr "RFC1918-private-subnets"
        set schedule "always"
        set service "ALL"
        set logtraffic all
    next
    edit 2
        set name "DIA DC -> Internet"
        set srcintf "port5"
        set dstintf "Inet"
        set srcaddr "DataCenter"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic disable
        set comments "Internet access for DC"
        set nat enable
    next
    edit 3
        set name "Corporate VPN -> DC"
        set srcintf "branches"
        set dstintf "port5" "loopback_VPNs"
        set srcaddr "Corporate"
        set dstaddr "DataCenter" "Overlays"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic disable
    next
    edit 4
        set name "RIA VPN -> Internet"
        set srcintf "branches"
        set dstintf "Inet"
        set srcaddr "Corporate"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic disable
        set comments "Remote Internet Breakout for Branches"
        set nat enable
    next
end

config router static
    edit 1
        set gateway 100.64.31.254
        set device "Inet"
    next
end