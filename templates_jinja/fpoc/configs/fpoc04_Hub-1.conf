# fpoc04 Hub-1 FortiOS 7.0.3
# context = {'mode': 'active_passive', 'hub1': '198.51.100.1', 'hub2': '198.51.100.2', 'name': 'Hub-1', 'fos_version': '7.0.3', 'FOS': 7000003, 'mgmt_fpoc': '172.16.31.254', 'HA': FortiGate_HA(mode=<Modes.STANDALONE: 0>, role=<Roles.STANDALONE: 0>, group_id=None, group_name=None, hbdev=None, sessyncdev=None, monitordev=None, priority=None), 'wan': WAN(inet=WanSettings(port='port1', vlanid=0, subnet='198.51.100'), inet_snat=WanSettings(port='port1', vlanid=200, subnet='192.168.200'), inet_dnat=WanSettings(port='port1', vlanid=201, subnet='192.168.201'), inet1=WanSettings(port='port1', vlanid=11, subnet='100.64.11'), inet1_snat=WanSettings(port='port1', vlanid=210, subnet='192.168.210'), inet1_dnat=WanSettings(port='port1', vlanid=211, subnet='192.168.211'), inet2=WanSettings(port='port1', vlanid=12, subnet='100.64.12'), inet2_snat=WanSettings(port='port1', vlanid=220, subnet='192.168.220'), inet2_dnat=WanSettings(port='port1', vlanid=221, subnet='192.168.221'), inet3=WanSettings(port='port1', vlanid=13, subnet='100.64.13'), inet3_snat=WanSettings(port='port1', vlanid=230, subnet='192.168.230'), inet3_dnat=WanSettings(port='port1', vlanid=231, subnet='192.168.231'), mpls1=WanSettings(port='port2', vlanid=14, subnet='10.0.14'), mpls2=WanSettings(port='port2', vlanid=15, subnet='10.0.15')), 'request': <WSGIRequest: POST '/poc/4/'>, 'csrf_input': '<input type="hidden" name="csrfmiddlewaretoken" value="8xCIphNQ9lZZyKm0amssed4cFvC80olBXXUxEKQL6wBpEURSo8OD46JMlJo2TtNb">', 'csrf_token': '1NHv2Ln5ZU2uzUN9JjVSOZx7Mn0W6VBwQdZkheq0W5EUF4i1X5h3EScHsBMQZ036'}
#
##################################################



config system global
    set hostname Hub-1
    
        
            set gui-theme graphite
        
    
end

# Internet and OOB management interfaces

config system interface
    edit "port1"
        set vdom "root"
        set mode static
        
            set ip 198.51.100.1 255.255.255.0
        
        set allowaccess ping
        set alias "Internet"
    next
    edit "port5"
        set vdom "root"
        set mode static
        
            set ip 192.168.1.1 255.255.255.0
        
        set allowaccess ping
        set alias "LAN"
    next
    edit "port6"
        set vdom "root"
        set mode static
        
            set ip 192.168.0.1 255.255.255.0
        
        set allowaccess ping
        set alias "ISFW"
    next
    edit "port10"
        set allowaccess ping https ssh http telnet
        set alias "OOB Management"
    next
end

# addresses and groups


## IPsec

config vpn ipsec phase1-interface
    edit "advpn"
        set type dynamic
        set interface "port1"
        set peertype any
        set net-device disable
        
        set add-route disable
        set auto-discovery-sender enable
        set dpd on-idle
        set dpd-retryinterval 60
        set proposal aes128-sha1
        set psksecret fortinet
    next
end

config vpn ipsec phase2-interface
    edit "advpn"
        set phase1name "advpn"
        set proposal aes128-sha1
    next
end

config system interface
    edit "advpn"
        
            set ip 10.10.10.1 255.255.255.255
            set remote-ip 10.10.10.254 255.255.255.0
        
        set allowaccess ping
    next
end

# FW policies

config firewall policy
    edit 1
        set srcintf "any"
        set dstintf "any"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
    next
end

## Routing

config router static
    edit 1
        set gateway 198.51.100.254
        set device "port1"
    next
end

config router prefix-list
    edit "PF_REDIS_CONNECTED"
        config rule
            edit 1
                
                    set prefix 192.168.1.0 255.255.255.0
                
                unset ge
                unset le
            next
            edit 2
                set prefix 192.168.0.0 255.255.255.0
                unset ge
                unset le
            next
        end
    next
end

config router route-map
    edit "RM_REDIS_CONNECTED"
        config rule
            edit 1
                set match-ip-address "PF_REDIS_CONNECTED"
            next
            edit 2
                set action deny
            next
        end
    next
    edit "RM_OSPF_TO_BGP"
        config rule
            edit 1
                
                    set set-local-preference 50
                
                set set-weight 0
            next
        end
    next
end

config router ospf
    
        set router-id 192.168.0.1
    
    config area
        edit 0.0.0.0
        next
    end
    config ospf-interface
        edit "isfw"
            set interface "port6"
            
                set priority 5
            
        next
    end
    config network
        edit 1
            set prefix 192.168.0.0 255.255.0.0
        next
    end
    config redistribute "bgp"
        set status enable
        
            set metric 1
            set tag 1
        
    end
end

config router bgp
    set as 65000
    
        set router-id 192.168.1.1
    
    set distance-internal 100
    config neighbor-group
        edit "advpn"
            set advertisement-interval 10
            set next-hop-self enable
            set remote-as 65000
            set keep-alive-timer 2
            set holdtime-timer 6
            set route-reflector-client enable
        next
    end
    config neighbor-range
        edit 1
            
                set prefix 10.10.10.0 255.255.255.0
            
            set neighbor-group "advpn"
        next
    end
    config redistribute "connected"
        set status enable
        set route-map "RM_REDIS_CONNECTED"
    end
    config redistribute "ospf"
        set status enable
        set route-map "RM_OSPF_TO_BGP"
    end
end