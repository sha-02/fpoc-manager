# fpoc03 FGT-B FortiOS 7.0.3
# context = {'i': 2, 'vpn': 'ipsec', 'routing': 'static', 'ike': '2', 'ipsec_phase1': 'static2static', 'fgta_inet1': '100.64.11.1', 'fgta_inet2': '100.64.12.1', 'fgtb_inet1': '100.64.21.2', 'fgtb_inet2': '100.64.22.2', 'name': 'FGT-B', 'fos_version': '7.0.3', 'FOS': 7000003, 'mgmt_fpoc': '172.16.31.254', 'HA': FortiGate_HA(mode=<Modes.STANDALONE: 0>, role=<Roles.STANDALONE: 0>, group_id=None, group_name=None, hbdev=None, sessyncdev=None, monitordev=None, priority=None), 'wan': WAN(inet=WanSettings(port='port1', vlanid=0, subnet='203.0.113'), inet_snat=WanSettings(port='port1', vlanid=200, subnet='192.168.200'), inet_dnat=WanSettings(port='port1', vlanid=201, subnet='192.168.201'), inet1=WanSettings(port='port1', vlanid=21, subnet='100.64.21'), inet1_snat=WanSettings(port='port1', vlanid=210, subnet='192.168.210'), inet1_dnat=WanSettings(port='port1', vlanid=211, subnet='192.168.211'), inet2=WanSettings(port='port1', vlanid=22, subnet='100.64.22'), inet2_snat=WanSettings(port='port1', vlanid=220, subnet='192.168.220'), inet2_dnat=WanSettings(port='port1', vlanid=221, subnet='192.168.221'), inet3=WanSettings(port='port1', vlanid=23, subnet='100.64.23'), inet3_snat=WanSettings(port='port1', vlanid=230, subnet='192.168.230'), inet3_dnat=WanSettings(port='port1', vlanid=231, subnet='192.168.231'), mpls1=WanSettings(port='port2', vlanid=24, subnet='10.0.24'), mpls2=WanSettings(port='port2', vlanid=25, subnet='10.0.25')), 'request': <WSGIRequest: POST '/poc/3/'>, 'csrf_input': '<input type="hidden" name="csrfmiddlewaretoken" value="xnZRmDmcU6A8h5yxkC3YdfphbKOnqOTEmNhGB6p7Rhcynf3pyop9384RRYAhjTle">', 'csrf_token': 'a6p6vKy5TsU0ZFx8xwd2CDp0qqrHkwmDZwHVKdB0QDwq5P20Lizdsw4A6EdBdBOd'}
#
##################################################








config system global
    set hostname FGT-B
    
        set gui-theme mariner
    
end

config system alias
    edit "sniff_client1"
        set command "diagnose sniffer packet any \'host 192.168.1.1\' 4"
    next
    edit "sniff_client11"
        set command "diagnose sniffer packet any \'host 192.168.11.1\' 4"
    next
    edit "sniff_client2"
        set command "diagnose sniffer packet any \'host 192.168.2.1\' 4"
    next
    edit "sniff_client22"
        set command "diagnose sniffer packet any \'host 192.168.22.1\' 4"
    next
    edit "flow_client1"
        set command "
diag debug flow filter clear
diag debug flow show function-name enable
diag debug flow filter addr 192.168.1.1
diag debug flow trace start 5
diag debug console time enable
diag debug enable"
    next
    edit "flow_client11"
        set command "
diag debug flow filter clear
diag debug flow show function-name enable
diag debug flow filter addr 192.168.11.1
diag debug flow trace start 5
diag debug console time enable
diag debug enable"
    next
    edit "flow_client2"
        set command "
diag debug flow filter clear
diag debug flow show function-name enable
diag debug flow filter addr 192.168.2.1
diag debug flow trace start 5
diag debug console time enable
diag debug enable"
    next
    edit "flow_client22"
        set command "
diag debug flow filter clear
diag debug flow show function-name enable
diag debug flow filter addr 192.168.22.1
diag debug flow trace start 5
diag debug console time enable
diag debug enable"
    next
    edit "flow_stop"
        set command "
diag debug flow trace stop
diag debug flow filter clear
diag debug console time disable
diag debug disable"
    next
end

# Internet and OOB management interfaces

config system interface
    edit "INET1"
        set vdom "root"
        set interface "port1"
        set mode static
        set vlanid 21
        set ip 100.64.21.2 255.255.255.0
        set allowaccess ping
        set alias "Internet-1"
        set role wan
    next
    edit "INET2"
        set vdom "root"
        set interface "port1"
        set mode static
        set vlanid 22
        set ip 100.64.22.2 255.255.255.0
        set allowaccess ping
        set alias "Internet-2"
        set role wan
    next
    edit "port5"
        set vdom "root"
        set mode static
        set ip 192.168.2.254 255.255.255.0
        set allowaccess ping
        set role lan
        set alias "LAN-2"
    next
    edit "port6"
        set vdom "root"
        set mode static
        set ip 192.168.22.254 255.255.255.0
        set allowaccess ping
        set role lan
        set alias "LAN-22"
    next
    edit "port10"
        set vdom "root"
        set allowaccess ping https ssh http telnet
        set alias "OOB Management"
    next
end


# addresses and groups

config firewall address
    edit "FGT1-LAN1"
        set allow-routing enable
        set subnet 192.168.1.0 255.255.255.0
    next
    edit "FGT1-LAN11"
        set allow-routing enable
        set subnet 192.168.11.0 255.255.255.0
    next
    edit "FGT2-LAN2"
        set allow-routing enable
        set subnet 192.168.2.0 255.255.255.0
    next
    edit "FGT2-LAN22"
        set allow-routing enable
        set subnet 192.168.22.0 255.255.255.0
    next
end

config firewall addrgrp
    edit "FGT1-LANs"
        set member "FGT1-LAN1" "FGT1-LAN11"
        set allow-routing enable
    next
    edit "FGT2-LANs"
        set member "FGT2-LAN2" "FGT2-LAN22"
        set allow-routing enable
    next
end








# First IPsec tunnel

config vpn ipsec phase1-interface
    
    edit "vpn1"
    

        
            set type static
            set peertype any
        
        set interface "INET1"
        set ike-version 2
        
        set proposal aes128-sha1
        set dhgrp 14
         
            set localid "FGT-B_vpn1"
            set remote-gw 100.64.11.1
        
        set psksecret 111111
    next
end

config vpn ipsec phase2-interface
    
    edit "vpn1"
        set phase1name "vpn1"
    

        set proposal aes128-sha1
        set dhgrp 14
        
        
        
    next
end

# Second IPsec tunnel

config vpn ipsec phase1-interface
    
    edit "vpn2"
    

        
            set type static
            set peertype any
        

        set interface "INET2"
        set ike-version 2
        
        set proposal aes128-sha1
        set dhgrp 14
         
            set localid "FGT-B_vpn2"
            set remote-gw 100.64.12.1
        
        set psksecret 222222
    next
end

config vpn ipsec phase2-interface
    
    edit "vpn2"
        set phase1name "vpn2"
    

        set proposal aes128-sha1
        set dhgrp 14
        
        
        
    next
end








# Policies

config firewall policy
    edit 4
        set name "Deny Internet"
        set srcintf "port5" "port6"
        set dstintf "INET1" "INET2"
        set srcaddr "RFC1918-private-subnets"
        set dstaddr "RFC1918-private-subnets"
        set schedule "always"
        set service "ALL"
        set logtraffic disable
    next
    edit 1
        set name "Internet Access"
        set srcintf "port5" "port6"
        set dstintf "INET1" "INET2"
        
            set srcaddr "FGT2-LANs"
        
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic disable
        set nat enable
    next
    edit 2
        set name "lan -> vpn"
        set srcintf "port5" "port6"
        set dstintf "vpn1" "vpn2"
        
            set srcaddr "FGT2-LANs"
            set dstaddr "FGT1-LANs"
        
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic disable
    next
    edit 3
        set name "vpn -> lan"
        set srcintf "vpn1" "vpn2"
        set dstintf "port5" "port6"
        
            set srcaddr "FGT1-LANs"
            set dstaddr "FGT2-LANs"
        
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic disable
    next
end

# Static default-routes for Internet and MPLS accesses

config router static
    edit 1
        set gateway 100.64.21.254
        set device "INET1"
        set comment "default-route to Internet-1"
    next
    edit 2
        set gateway 100.64.22.254
        set device "INET2"
        set comment "default-route to Internet-2"
    next
end


# =============== static routing ======================================================================
#
config router static
    edit 11
        set device "vpn1"
        
            set dstaddr "FGT1-LANs"
        
    next
    edit 22
        set device "vpn2"
        
            set dstaddr "FGT1-LANs"
        
    next
end











